#!/usr/bin/env ruby

require_relative '../lib/jumping_chess'

TURNS = Integer(ARGV[0] || 10)
MAX_DEPTH = Integer(ARGV[1] || 1)
STRATEGY1 = ARGV[2] || "minimax"
STRATEGY2 = ARGV[3] || STRATEGY1

p1 = Player.new(1, STRATEGY1, MAX_DEPTH)
p2 = Player.new(2, STRATEGY2, MAX_DEPTH)
game = Game.new(p1, p2, INITIAL_STATE)

if ENV["PROFILE"]
  require 'stackprof'
  StackProf.start(mode: :cpu)
  at_exit do
    StackProf.stop
    StackProf.results("#{Dir.pwd}/cpu.dump")
  end
end

TURNS.times do
  game.turn
  game.show(scores: true)

  if game.finished?
    puts "Player #{game.winner.inspect} won!"
    break
  end
end
